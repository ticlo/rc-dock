import{r as u,a as B}from"./client-39e4e055.js";import{c as P,m as N,d as H,f as R,e as k,g as U,p as q,i as A,j as G,k as O,l as j,r as E,F as C,n as z,o as w,q as X,s as S,u as Y,v as I,w as Z,x as $,y as J,z as K,A as Q,B as V,C as ee,E as te,W as ae,G as oe}from"./DividerBox-ceca883c.js";class ie extends u.PureComponent{render(){let{children:e}=this.props.boxData,t=[];for(let o of e)"tabs"in o&&t.push(u.createElement(P,{size:o.size,panelData:o,key:o.id}));return u.createElement("div",{className:"dock-box dock-fbox"},t)}}function se(d,e){e.panels.set(d.id,d);for(let t of d.tabs)e.tabs.set(t.id,t)}function v(d,e){for(let t of d.children)"tabs"in t?se(t,e):"children"in t&&v(t,e)}function le(d){let e={panels:new Map,tabs:new Map};return d&&("children"in d?v(d,e):("dockbox"in d&&v(d.dockbox,e),"floatbox"in d&&v(d.floatbox,e))),e}function F(d,e,t){function o(i){return e?e(i):{id:i.id}}function r(i){let n=[];for(let m of i.tabs){let p=o(m);p&&n.push(p)}let{id:l,size:s,activeId:c,group:h,panelLock:b}=i,f;if(i.parent.mode==="float"||i.parent.mode==="window"){let{x:m,y:p,z:x,w:y,h:D}=i;f={id:l,size:s,tabs:n,group:h,activeId:c,panelLock:b,x:m,y:p,z:x,w:y,h:D}}else f={id:l,size:s,tabs:n,group:h,activeId:c,panelLock:b};return t&&t(f,i),f}function a(i){let n=[];for(let h of i.children)"tabs"in h?n.push(r(h)):"children"in h&&n.push(a(h));let{id:l,size:s,mode:c}=i;return{id:l,size:s,mode:c,children:n}}return{dockbox:a(d.dockbox),floatbox:a(d.floatbox),windowbox:a(d.windowbox),maxbox:a(d.maxbox)}}function ne(d,e,t,o){let r=le(e);function a(l){if(t)return t(l);let{id:s}=l;return r.tabs.has(s)?r.tabs.get(s):null}function i(l){let{id:s,size:c,activeId:h,x:b,y:f,z:m,w:p,h:x,group:y,panelLock:D}=l,_=[];for(let M of l.tabs){let T=a(M);T&&_.push(T)}let g;return p||x||b||f||m?g={id:s,size:c,activeId:h,group:y,x:b,y:f,z:m,w:p,h:x,tabs:_,panelLock:D}:g={id:s,size:c,activeId:h,group:y,tabs:_,panelLock:D},l.id===N?g.panelLock={}:o?o(l,g):r.panels.has(s)&&(g={...r.panels.get(s),...g}),g}function n(l){if(!l)return null;let s=[];for(let f of l.children)"tabs"in f?s.push(i(f)):"children"in f&&s.push(n(f));let{id:c,size:h,mode:b}=l;return{id:c,size:h,mode:b,children:s}}return{dockbox:n(d.dockbox),floatbox:n(d.floatbox??{mode:"float",children:[],size:0}),windowbox:n(d.windowbox??{mode:"window",children:[],size:0}),maxbox:n(d.maxbox??{mode:"maximize",children:[],size:1})}}class W extends u.PureComponent{render(){let e=this.props.boxData.children[0];if(e)return this.hidePanelData={...e,id:"",tabs:[]},u.createElement("div",{className:"dock-box dock-mbox dock-mbox-show"},u.createElement(P,{size:100,panelData:e}));if(this.hidePanelData){let t=this.hidePanelData;return this.hidePanelData=null,u.createElement("div",{className:"dock-box dock-mbox dock-mbox-hide"},u.createElement(P,{size:100,panelData:t}))}else return u.createElement("div",{className:"dock-box dock-mbox dock-mbox-hide"})}}class re extends u.PureComponent{constructor(){super(...arguments),this._caches=new Map,this._isMounted=!1,this.destroyRemovedPane=()=>{this._pendingDestroy=null;let e=!1;for(let[t,o]of this._caches)o.owner==null&&(this._caches.delete(t),e=!0);e&&this._isMounted&&this.forceUpdate()}}getTabCache(e,t){let o=this._caches.get(e);if(o)o.owner=t;else{let r=document.createElement("div");r.className="dock-pane-cache",o={div:r,id:e,owner:t},this._caches.set(e,o)}return o}removeTabCache(e,t){let o=this._caches.get(e);o&&o.owner===t&&(o.owner=null,this._pendingDestroy||(this._pendingDestroy=setTimeout(this.destroyRemovedPane,1)))}updateTabCache(e,t){let o=this._caches.get(e);o&&(o.portal=B.createPortal(t,o.div,o.id),this.forceUpdate())}}class L extends re{constructor(e){var i;super(e),this.getRef=n=>{this._ref=n},this.onDragStateChange=n=>{n==null&&(P.droppingPanel=null,this.state.dropRect&&this.setState({dropRect:null}))},this._onWindowResize=H(()=>{let n=this.getLayout();if(this._ref){let l=R(n,this._ref.offsetWidth,this._ref.offsetHeight);n!==l&&(l=k(l,this.props.groups),this.changeLayout(l,null,"move"))}},200);let{layout:t,defaultLayout:o,loadTab:r}=e,a;if(o)a=this.prepareInitData(e.defaultLayout);else if(!r)throw new Error("DockLayout.loadTab and DockLayout.defaultLayout should not both be undefined.");t?this.state={layout:L.loadLayoutData(t,e),dropRect:null}:this.state={layout:a,dropRect:null},U(this.onDragStateChange),(i=globalThis.addEventListener)==null||i.call(globalThis,"resize",this._onWindowResize)}getRootElement(){return this._ref}prepareInitData(e){let t={...e};return k(t,this.props.groups,this.props.loadTab),t}getDockId(){return this.props.dockId||this}getGroup(e){if(e){let{groups:t}=this.props;if(t&&e in t)return t[e];if(e===q)return A}return G}dockMove(e,t,o,r){let a=this.getLayout();if(o==="maximize"?(a=O(a,e),this.panelToFocus=e.id):o==="front"?a=j(a,e):a=E(a,e),typeof t=="string"?t=this.find(t,C.All):t=z(t),o==="float"){let i=w(e);i.z=X(null),this.state.dropRect||r?a=S(a,i,this.state.dropRect||r):(a=S(a,i),this._ref&&(a=R(a,this._ref.offsetWidth,this._ref.offsetHeight)))}else if(o==="new-window"){let i=w(e);a=Y(a,i)}else if(t)if("tabs"in t)if(o==="middle")a=I(a,e,t);else{let i=w(e);a=Z(a,i,t,o)}else if("children"in t){let i=w(e);a=$(a,i,t,o)}else a=J(a,e,t,o);if(a!==this.getLayout()){a=k(a,this.props.groups);const i=e.hasOwnProperty("tabs")?e.activeId:e.id;this.changeLayout(a,i,o)}this.onDragStateChange(!1)}find(e,t){return K(this.getLayout(),e,t)}getLayoutSize(){return this._ref?{width:this._ref.offsetWidth,height:this._ref.offsetHeight}:{width:0,height:0}}updateTab(e,t,o=!0){let r=this.find(e,C.AnyTab);if(!r)return!1;let a=r.parent,i=a.tabs.indexOf(r);if(i>=0){let{loadTab:n}=this.props,l=this.getLayout();if(t){let s=a.activeId;n&&!("content"in t&&"title"in t)&&(t=n(t)),l=E(l,r),a=z(a),l=I(l,t,a,i),a=z(a),o||(a.activeId=s,this.panelToFocus=a.id)}else o&&a.activeId!==e&&(l=Q(l,a,{...a,activeId:e}));return l=k(l,this.props.groups),this.changeLayout(l,(t==null?void 0:t.id)??e,"update"),!0}}navigateToPanel(e,t){if(!t){e||(e=this._ref.querySelector(".dock-tab-active>.dock-tab-btn")),e.focus();return}let o,r=t==="ArrowUp"||t==="ArrowDown"?".dock>.dock-bar":".dock-box>.dock-panel",a=Array.from(this._ref.querySelectorAll(r)),i=a.find(s=>s.contains(e)),n=i.getBoundingClientRect(),l=[];for(let s of a)if(s!==i){let c=s.getBoundingClientRect(),h=V(n,c,t);h>=0&&l.push({panel:s,rect:c,distance:h})}l.sort((s,c)=>s.distance-c.distance);for(let s of l)if(o=s.panel.querySelector(".dock-tab-active>.dock-tab-btn"),o)break;o&&o.focus()}useEdgeDrop(){return this.props.dropMode==="edge"}setDropRect(e,t,o,r,a=[300,300]){let{dropRect:i}=this.state;if(i){if(t==="remove"){this.setState(x=>x.dropRect.source===o?{dropRect:null}:{});return}else if(i.element===e&&i.direction===t&&t!=="float")return}if(!e){this.setState({dropRect:null});return}let n=this._ref.getBoundingClientRect(),l=this._ref.offsetWidth/n.width,s=this._ref.offsetHeight/n.height,c=e.getBoundingClientRect(),h=(c.left-n.left)*l,b=(c.top-n.top)*s,f=c.width*l,m=c.height*s,p=.5;switch(e.classList.contains("dock-box")&&(p=.3),t){case"float":{let x=(r.clientX-n.left)*l;b=(r.clientY-n.top)*s-15,f=a[0],m=a[1],h=x-(f>>1);break}case"right":h+=f*(1-p);case"left":f*=p;break;case"bottom":b+=m*(1-p);case"top":m*=p;break;case"after-tab":h+=f-15,f=30;break;case"before-tab":h-=15,f=30;break}this.setState({dropRect:{left:h,top:b,width:f,height:m,element:e,source:o,direction:t}})}render(){this.tempLayout=null;let{style:e,maximizeTo:t}=this.props,{layout:o,dropRect:r}=this.state,a;if(r){let{element:l,direction:s,...c}=r;a={...c,display:"block"},s==="float"&&(a.transition="none")}let i;t?(typeof t=="string"&&(t=document.getElementById(t)),i=B.createPortal(u.createElement(W,{boxData:o.maxbox}),t)):i=u.createElement(W,{boxData:o.maxbox});let n=[];for(let[l,s]of this._caches)s.portal&&n.push(s.portal);return u.createElement("div",{ref:this.getRef,className:"dock-layout",style:e},u.createElement(ee,{value:this},u.createElement(te,{size:1,boxData:o.dockbox}),u.createElement(ie,{boxData:o.floatbox}),u.createElement(ae,{boxData:o.windowbox}),i,n),u.createElement("div",{className:"dock-drop-indicator",style:a}))}componentDidMount(){this._isMounted=!0}componentDidUpdate(e,t,o){var r;if(this.panelToFocus){let a=this._ref.querySelector(`.dock-panel[data-dockid="${this.panelToFocus}"]`);a&&!a.contains(this._ref.ownerDocument.activeElement)&&((r=a.querySelector(".dock-bar"))==null||r.focus()),this.panelToFocus=null}}componentWillUnmount(){var e;(e=globalThis.removeEventListener)==null||e.call(globalThis,"resize",this._onWindowResize),oe(this.onDragStateChange),this._onWindowResize.cancel(),this._isMounted=!1}setLayout(e){this.tempLayout=e,this.setState({layout:e})}getLayout(){return this.tempLayout||this.state.layout}changeLayout(e,t,o,r=!1){let{layout:a,onLayoutChange:i}=this.props,n;i&&(n=F(e,this.props.saveTab,this.props.afterPanelSaved),e.loadedFrom=n,i(n,t,o),a&&this.forceUpdate()),!a&&!r&&this.setLayout(e)}onSilentChange(e=null,t){let{onLayoutChange:o}=this.props;if(o){let r=this.getLayout();this.changeLayout(r,e,t,!0)}}saveLayout(){return F(this.getLayout(),this.props.saveTab,this.props.afterPanelSaved)}loadLayout(e){this.setLayout(L.loadLayoutData(e,this.props,this._ref.offsetWidth,this._ref.offsetHeight))}static loadLayoutData(e,t,o=0,r=0){let{defaultLayout:a,loadTab:i,afterPanelLoaded:n,groups:l}=t,s=ne(e,a,i,n);return s=R(s,o,r),s=k(s,l),s.loadedFrom=e,s}static getDerivedStateFromProps(e,t){let{layout:o}=e,{layout:r}=t;return o&&o!==r.loadedFrom?{layout:L.loadLayoutData(o,e)}:null}}export{L as D};
